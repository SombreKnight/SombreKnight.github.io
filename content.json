{"meta":{"title":"张晨曦的博客","subtitle":"个人博客","description":"技术分享 工作心得 生活感悟","author":"张晨曦","url":"https://sombreknight.gitee.io","root":"/"},"pages":[{"title":"404 Not Found：该页无法显示","date":"2021-01-09T03:02:07.343Z","updated":"2021-01-09T03:02:07.343Z","comments":false,"path":"/404.html","permalink":"https://sombreknight.gitee.io/404.html","excerpt":"","text":""},{"title":"分类","date":"2021-01-09T02:59:20.699Z","updated":"2021-01-09T02:59:20.699Z","comments":false,"path":"index.html","permalink":"https://sombreknight.gitee.io/index.html","excerpt":"","text":""},{"title":"分类","date":"2021-01-09T03:00:41.011Z","updated":"2021-01-09T03:00:41.011Z","comments":false,"path":"categories/index.html","permalink":"https://sombreknight.gitee.io/categories/index.html","excerpt":"","text":""},{"title":"关于","date":"2021-01-09T06:23:36.265Z","updated":"2021-01-09T06:23:36.257Z","comments":false,"path":"about/index.html","permalink":"https://sombreknight.gitee.io/about/index.html","excerpt":"","text":"1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980&#123; &quot;name&quot;: &quot;张晨曦&quot;, &quot;age&quot;: 24, &quot;profession&quot;: &quot;Java Developer&quot;, &quot;experience&quot;: &quot;2年&quot;, &quot;address&quot;: &quot;四川省成都市&quot;, &quot;education&quot;: &quot;本科&quot;, &quot;github&quot;: &quot;https://github.com/SombreKnight&quot;, &quot;blog&quot;: &quot;https://sombreknight.github.io&quot;, &quot;email&quot;: &quot;dlmu_zhangchenxi@foxmail.com&quot;, &quot;description&quot;: &quot;五年开发经验的两年Java工程师&quot;, &quot;skills&quot;: &#123; &quot;Java&quot;: [ &quot;Basic Java&quot;, &quot;Java Collection&quot;, &quot;Java IO&quot;, &quot;Java Concurrent&quot;, &quot;JVM &amp; GC&quot; ], &quot;Web FrameWork&quot;: [ &quot;Spring&quot;, &quot;SpringMVC&quot;, &quot;SpringBoot&quot; ], &quot;SpringCloud&quot;: [ &quot;Eureka&quot;, &quot;Ribbon&quot;, &quot;Open Feign&quot;, &quot;Hystrix&quot;, &quot;GateWay&quot; ], &quot;SpringCloudAlibaba&quot;: [ &quot;Nacos&quot;, &quot;Sentinel&quot;, &quot;Dubbo&quot;, &quot;Seata&quot; ], &quot;Web Security&quot;: [ &quot;XSS&quot;, &quot;CSRF&quot;, &quot;SQL injection&quot;, &quot;Upload vulnerability&quot;, &quot;Download vulnerability&quot;, &quot;Url Jump vulnerability&quot; ], &quot;MiddleWare&quot;: [ &quot;Redis&quot;, &quot;Zookeeper&quot;, &quot;RabbitMQ&quot;, &quot;Kafka&quot; ], &quot;Software Engineering&quot;: [ &quot;Design Parttern&quot;, &quot;Code Clean Way&quot;, &quot;Refactor&quot;, &quot;DDD&quot; ], &quot;Linux&quot;: [ &quot;basic cmd&quot;, &quot;shell&quot;, &quot;basic ops skills&quot; ], &quot;BigData&quot;: [ &quot;Hadoop&quot;, &quot;Spark&quot;, &quot;Flink&quot; ], &quot;Others&quot;: [ &quot;SVN&quot;, &quot;GIT&quot;, &quot;Maven&quot;, &quot;Docker&quot;, &quot;ELK&quot;, &quot;Python&quot;, &quot;Php&quot;, &quot;JavaScript&quot;, &quot;VUE&quot; ] &#125;&#125;"},{"title":"友情链接","date":"2021-01-09T02:57:00.089Z","updated":"2021-01-09T02:57:00.089Z","comments":true,"path":"links/index.html","permalink":"https://sombreknight.gitee.io/links/index.html","excerpt":"","text":""},{"title":"项目","date":"2021-01-09T06:50:06.768Z","updated":"2021-01-09T06:50:06.760Z","comments":false,"path":"repository/index.html","permalink":"https://sombreknight.gitee.io/repository/index.html","excerpt":"","text":""},{"title":"标签","date":"2021-01-09T02:59:59.946Z","updated":"2021-01-09T02:59:59.946Z","comments":false,"path":"tags/index.html","permalink":"https://sombreknight.gitee.io/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"《高并发红包炸弹项目性能优化》系列一：项目介绍","slug":"MRWloLteKJcf5Idr","date":"2021-01-13T15:06:44.000Z","updated":"2021-01-13T15:07:12.000Z","comments":true,"path":"2021/01/13/MRWloLteKJcf5Idr/","link":"","permalink":"https://sombreknight.gitee.io/2021/01/13/MRWloLteKJcf5Idr/","excerpt":"","text":"一、项目介绍​ 受疫情影响，公司打算在今年搞一次全国医生线上年会。而公司为了或是引流、或是给医生分福利，计划设计一个砸钱抢红包的环节。运气非常不错，虽然整体方案最初的设计不是我做的，但是最后此红包项目的性能优化却落到了我这里。平常的业务项目里，大多接触不到高并发场景，故借此机会，对此项目进行一个好好优化梳理，相信一定会对自己大有裨益的。 首先介绍下抢红包的流程，如下图所示： 首先是年会活动主会场界面，如下图一所示，右下角展示的就是红包炸弹，当有炸弹即将在1分钟后爆开时，就会进入此60秒倒计时。当倒计时完成时界面出现抢红包的云朵图案，如下图二所示。 当点击抢红包云朵图案时，有一下情况： 用户没有报名参加年会，是无法参与抢红包的，会提示还没报名，并引导用户去报名页面，如下图一所示； 用户点击云朵，但是没有抢到红包，提示手慢了，如下图二所示； 用户点击云朵，成功抢到了，点击开红包，查看红包明细，如下图三所示； 用户点击云朵，系统检测出来该用户今天已经成功抢到三次红包了，提示已经3连冠，把机会让给别人。如下图四所示。 用户点击云朵，系统检测出来该用户已经抢成功过了当前红包，直接进入红包明细，如下图五所示。 后台投放红包很简单，管理员可以在后台投放红包炸弹，指定什么时候炸开，投放的红包会分成多少份，总金额是多少。如下图所示： 产品的一些关键特殊的要求，汇总如下： 一个红包炸开了，最多抢15s，这个红包就会被自动置完成，用户不能再抢了 一个用户一天最多抢成功3个红包 一个红包，同一用户最多只能抢成功一次 管理员随时可以在后台取消红包 至此，相信大家对此项目已经有了一定的基本了解。我再附上一张流程图更好的说明整个流程。 二、难点分析这个项目是有一定难度的，具体难在哪儿，我个人的看法如下： 公司的医生用户基数大，年会报名人数预计在30万+，年会当晚会持续多轮红包炸弹轰炸，平均QPS约为在30w/15s = 2000，但是抢红包的这15s不可能每一秒钟都qps都是均衡的，预计峰值QPS可能达到30w/5s = 6000左右，也就是预计在红包炸弹炸开的前5sQPS应该是最高的时候。查阅资料 可知，如微博每天1亿多pv的系统一般也就1500QPS，5000QPS峰值。但是具体多少QPS跟业务强相关，只读接口读缓存，将压力给到缓存单机3000+没问题，写请求1000+也正常，也复杂些可能也就几百+QPS。 如此高的并发下，我们很容易在服务层面想到加机器，但是最应该保护的其实是DB。如果一个红包分成了1000个子红包，这意味着抢完这个红包最多要写库1000次。感觉写库的量并不大，但是要知道的是，这1000次写库非常集中，瞬时写库会给DB造成比较大的压力，可能导致并发下其他查询事务受到影响，甚至影响到其他业务。故我们需要对必要的接口进行流量控制以保证接口的吞吐量维持在一个较高的位置，但是又不会直接影响到服务性能。 并发下，如何保证不“超买”。其实就是发了1万元红包，不能因为并发原因，就让用户抢出去2万块钱了。底线就是，宁可让用户抢不到，也不能抢超了。 怎样避免羊毛党，恶意刷接口等操作造成公司利益受损？ 三、总结好了，到这里我们先对此项目有个整体上的感知即可。 抢红包面向医生群体，数量约30w+；抢红包需要先报名；一天最多抢成功三次；同一红包只能抢成功一次。 下一篇文章具体介绍下这个项目的数据库表设计，以及他们的接口代码实现。","categories":[{"name":"高并发项目","slug":"高并发项目","permalink":"https://sombreknight.gitee.io/categories/%E9%AB%98%E5%B9%B6%E5%8F%91%E9%A1%B9%E7%9B%AE/"},{"name":"系列文章","slug":"高并发项目/系列文章","permalink":"https://sombreknight.gitee.io/categories/%E9%AB%98%E5%B9%B6%E5%8F%91%E9%A1%B9%E7%9B%AE/%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"红包","slug":"红包","permalink":"https://sombreknight.gitee.io/tags/%E7%BA%A2%E5%8C%85/"},{"name":"高并发","slug":"高并发","permalink":"https://sombreknight.gitee.io/tags/%E9%AB%98%E5%B9%B6%E5%8F%91/"},{"name":"性能优化","slug":"性能优化","permalink":"https://sombreknight.gitee.io/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"}]},{"title":"博客计划","slug":"f2hoimvLZitLtDEL","date":"2021-01-10T05:26:20.000Z","updated":"2021-01-10T05:08:31.000Z","comments":true,"path":"2021/01/10/f2hoimvLZitLtDEL/","link":"","permalink":"https://sombreknight.gitee.io/2021/01/10/f2hoimvLZitLtDEL/","excerpt":"","text":"基础系列 数据结构之树系列 算法系列（贪心、回溯、动态规划） 操作系统系列（操作系统基础、UNIX基础） 计算机网络系列（IP协议、TCP协议、HTTP协议） Java系列 Java语言基础 Java集合框架（包含并发集合框架） Java多线程与高并发（锁、AQS、阻塞队列等） JVM系列（对象头、GC、JVM调优） Web框架系列 Spring框架（IOC、AOP、事务） SpringMVC框架（请求分发流程） SpringBoot(自动配置原理) SpringCloud系列 Eureka Ribbon OpenFeign Hystrix GateWay SpringCloud Alibaba系列 Nacos Sentinel Dubbo Seata 数据库系列 MySQL（SQL优化、锁、底层索引原理、分库分表、高可用） MongoDB ElasticSearch 中间件系列 Redis（数据结构、缓存/分布式锁/限流器等应用、缓存穿透/击穿/雪崩概念和解决方案、日志、主从/哨兵/集群） Zookeeper(基本使用、ZAB协议基本原理、高可用方案) RabbitMQ(基本概念和使用、高可用方案) Kafka（基本概念和使用、高可用方案） 软件工程系列 设计模式（结合Spring框架中的案例） 代码整洁之道 重构 领域对象模型 开源项目系列 手写Spring框架 基于RestTemplate封装一个Rpc框架，且支持全链路监控、支持限流/熔断/降级、支持同步/异步调用 基于JdbcTemplate封装一个Dao框架，支持乐观锁、支持单机一级和Redis二级实体缓存","categories":[{"name":"博客计划","slug":"博客计划","permalink":"https://sombreknight.gitee.io/categories/%E5%8D%9A%E5%AE%A2%E8%AE%A1%E5%88%92/"}],"tags":[{"name":"博客计划","slug":"博客计划","permalink":"https://sombreknight.gitee.io/tags/%E5%8D%9A%E5%AE%A2%E8%AE%A1%E5%88%92/"}]}],"categories":[{"name":"高并发项目","slug":"高并发项目","permalink":"https://sombreknight.gitee.io/categories/%E9%AB%98%E5%B9%B6%E5%8F%91%E9%A1%B9%E7%9B%AE/"},{"name":"系列文章","slug":"高并发项目/系列文章","permalink":"https://sombreknight.gitee.io/categories/%E9%AB%98%E5%B9%B6%E5%8F%91%E9%A1%B9%E7%9B%AE/%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/"},{"name":"博客计划","slug":"博客计划","permalink":"https://sombreknight.gitee.io/categories/%E5%8D%9A%E5%AE%A2%E8%AE%A1%E5%88%92/"}],"tags":[{"name":"红包","slug":"红包","permalink":"https://sombreknight.gitee.io/tags/%E7%BA%A2%E5%8C%85/"},{"name":"高并发","slug":"高并发","permalink":"https://sombreknight.gitee.io/tags/%E9%AB%98%E5%B9%B6%E5%8F%91/"},{"name":"性能优化","slug":"性能优化","permalink":"https://sombreknight.gitee.io/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"},{"name":"博客计划","slug":"博客计划","permalink":"https://sombreknight.gitee.io/tags/%E5%8D%9A%E5%AE%A2%E8%AE%A1%E5%88%92/"}]}